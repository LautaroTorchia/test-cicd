name: CD Pipeline - Aplicación Empresarial

on:
  workflow_run:
    workflows: ["CI Pipeline - Aplicación Empresarial"]
    types:
      - completed

jobs:
  package-and-version:
    name: 📦 Empaquetar + 🏷️ Versionar
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: Empaquetar artefacto Docker
        run: echo "Artefacto Docker generado"
      - name: Generar versión SemVer
        run: echo "Versión 1.0.0 generada y etiquetada"

  deploy-dev:
    name: 🚀 Despliegue Dev
    runs-on: ubuntu-latest
    needs: package-and-version
    steps:
      - name: Desplegar en Dev
        run: echo "Aplicación desplegada en desarrollo"

  deploy-qa:
    name: 🔬 Despliegue QA
    runs-on: ubuntu-latest
    needs: deploy-dev
    steps:
      - name: Desplegar en QA
        run: echo "Aplicación desplegada en QA"

  validations:
    name: 🔐 Validaciones Post-QA
    runs-on: ubuntu-latest
    needs: deploy-qa
    steps:
      - name: Escaneo de Seguridad
        run: echo "Escaneo aprobado"
      - name: Pruebas de Performance
        run: echo "Rendimiento verificado"

  deploy-staging:
    name: 🧪 Staging
    runs-on: ubuntu-latest
    needs: validations
    steps:
      - name: Desplegar en Staging
        run: echo "Aplicación en entorno Staging"

  approval-and-prod:
    name: 🛂 Aprobación → 🏁 Producción
    runs-on: ubuntu-latest
    needs: deploy-staging
    steps:
      - name: Aprobación Manual
        run: echo "Aprobación concedida"
      - name: Despliegue en Producción
        run: echo "Aplicación desplegada en Producción"

